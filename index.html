<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Folke sök – Institutet för språk och folkminnen">
    <meta name="description" content="Folke är en digital arkivtjänst från Institutet för språk och folkminnen (Isof). Här finns ett urval av äldre folkminnesmaterial och dialektinspelningar.">
    <meta property="og:image" content="https://sok.folke.isof.se/img/og-screenshot.png">
    <meta property="og:locale" content="sv_SE">
    <meta property="og:type" content="website">

    <title>Folke sök - Institutet för språk och folkminnen</title>
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png"/>
    <link rel="preload" as="image" href="/img/logotyp-isof.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://matomo.isof.se" crossorigin="anonymous">
    <link rel="dns-prefetch" href="//matomo.isof.se">

    <style>
        .loader {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            height: 80px;
        }
    </style>
    <script type="text/javascript">
        const hostname = window.location.hostname;
        const is_dev = ["127.0.0.1", "localhost", "0.0.0.0"].some(h => hostname.includes(h));
        const is_test = ["-test."].some(m => hostname.includes(m));
        const ENV = is_dev ? "dev" : (is_test ? "test" : "prod");

        // Matomo 

        const matomo_site_ids = {
            'dev': 62,
            'test': 65,
            'prod': 17,
        }

        const siteId = matomo_site_ids[ENV];

        if (ENV !== 'prod') {
            console.log("Matomo siteId: " + siteId);
        }

        var _paq = window._paq = window._paq || [];
        /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
        // Helper to build SPA URL (incl. hash)
        const getUrl = () => window.location.pathname + window.location.search + window.location.hash;
        let lastTrackedUrl = getUrl(); // Inkluderar query-parametrar
        //wait for new title before sending data to matomo
        (function() {
            const u = "https://matomo.isof.se/";
            _paq.push(['setTrackerUrl', u + 'matomo.php']);
            _paq.push(['setSiteId', siteId]);
            _paq.push(['enableLinkTracking']);
            const d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async = true; g.src = u + 'matomo.js'; s.parentNode.insertBefore(g, s);
        })();
        
        // Wait for title if needed, then send the first page view
        setTimeout(function () {
            _paq.push(['setCustomUrl', lastTrackedUrl]);
            _paq.push(['setDocumentTitle', document.title]);
            _paq.push(['trackPageView']);
        }, 1000);

        // Function to handle page view tracking
        function trackPageView() {
            const newUrl = getUrl();
            if (newUrl === lastTrackedUrl) return; // de-dupe
            if (ENV !== 'prod') console.log("Tracking page view for URL:", newUrl);
            
            _paq.push(['setReferrerUrl', lastTrackedUrl]);
            lastTrackedUrl = newUrl;
            _paq.push(['setCustomUrl', lastTrackedUrl]);
            _paq.push(['setDocumentTitle', document.title]);
            _paq.push(['deleteCustomVariables', 'page']);
            _paq.push(['trackPageView']);
            
            // Content scans (no-op if plugin not installed)
            const content = document.getElementById('app');
            _paq.push(['MediaAnalytics::scanForMedia', content]);
            _paq.push(['FormAnalytics::scanForForms', content]);
            _paq.push(['trackContentImpressionsWithinNode', content]);
            _paq.push(['enableLinkTracking']);
        }

        // Listen to popstate event for back/forward navigation
        window.addEventListener('popstate', function () {
            setTimeout(trackPageView, 1000);
        });

        // Patch pushState and replaceState to detect navigation
        (function(history){
            const pushState = history.pushState;
            const replaceState = history.replaceState;
            history.pushState = function(state) {
                const result = pushState.apply(history, arguments);
                window.dispatchEvent(new PopStateEvent('popstate', { state }));
                return result;
            };
            history.replaceState = function(state) {
                const result = replaceState.apply(history, arguments);
                window.dispatchEvent(new PopStateEvent('popstate', { state }));
                return result;
            };
        })(window.history);
    </script>
     
    <!-- End Matomo Code -->
    <script type="text/javascript">
        // This script toggles the 'tab-navigation' class on the body element.
        // It adds the class when the Tab key is pressed for better keyboard navigation,
        // and removes it when the mouse is clicked or touch event is fired.

        // We need this because we want to show the focus outline only when the user
        // is navigating with the keyboard, not when they are using the mouse or touch.

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') document.body.classList.add('tab-navigation');
        }, { passive: true });

        ['pointerdown', 'click'].forEach(type => {
            document.addEventListener(type, () => {
                document.body.classList.remove('tab-navigation');
            }, { passive: true });
        });
    </script>
</head>

<body>
    <!-- Page content starts here -->
    <div id="app" aria-busy="true" aria-live="polite">
        <img src="img/loader.gif" class="loader" alt="Laddar…" role="status" aria-live="polite">
    </div>
    <!-- Page content stops here -->

    <!-- add a overlay on the top right corner that is always above all other elements and shows
    the value for the localstorage variable "placeViewId" -->
    <!-- <div id="placeViewIdOverlay" style="position: fixed; top: 0; right: 100px; z-index: 9999; background-color: white; padding: 5px; border: 1px solid black;">
        <span id="placeViewIdOverlayText"></span> -->
        <!-- add a script that adds the value for placeViewId to the above span, 
            and update it every 100ms -->
        <!-- <script>
            setInterval(function () {
                var placeViewId = localStorage.getItem('placeViewId');
                document.getElementById('placeViewIdOverlayText').innerHTML = placeViewId;
            }, 100);
        </script> -->

    <!-- </div> -->

    <!-- Error monitor (dev only): shows console errors in-app -->
    <script>
        (function () {
            const { hostname } = window.location;
            const isDev = ['127.0.0.1', 'localhost', '0.0.0.0'].some((element) => hostname.includes(element));
            const isTest = ['-test.'].some((element) => hostname.includes(element));
            if (!isDev) return;
            const monitor = document.createElement('div');
            monitor.id = 'errorMonitor';
            monitor.style.position = 'fixed';
            monitor.style.bottom = '0';
            monitor.style.left = '0';
            monitor.style.width = '100%';
            monitor.style.maxHeight = '200px';
            monitor.style.overflowY = 'auto';
            monitor.style.backgroundColor = '#f8d7da';
            monitor.style.color = '#721c24';
            monitor.style.borderTop = '1px solid #f5c6cb';
            monitor.style.fontSize = '14px';
            monitor.style.fontFamily = 'monospace';
            monitor.style.padding = '5px';
            monitor.style.zIndex = '9999';
            // start hidden; show only when an error occurs
            monitor.style.display = 'none';
            document.body.appendChild(monitor);
            const closeButton = document.createElement('button');
            closeButton.textContent = '×';
            closeButton.style.position = 'absolute';
            closeButton.style.top = '4px';
            closeButton.style.right = '8px';
            closeButton.style.background = 'transparent';
            closeButton.style.border = 'none';
            closeButton.style.fontSize = '16px';
            closeButton.style.cursor = 'pointer';
            closeButton.style.color = '#721c24';
            closeButton.addEventListener('click', function () {
                monitor.style.display = 'none';
            });
            monitor.appendChild(closeButton);
            const header = document.createElement('div');
            header.textContent = 'Error:';
            header.style.fontWeight = 'bold';
            header.style.marginBottom = '4px';
            monitor.appendChild(header);
            const list = document.createElement('ul');
            list.id = 'errList';
            list.style.margin = '0';
            list.style.padding = '0';
            list.style.listStyle = 'none';
            monitor.appendChild(list);
            function addError(msg) {
                // reveal on first error
                if (monitor.style.display === 'none') monitor.style.display = 'block';
                const li = document.createElement('li');
                li.textContent = msg;
                li.style.padding = '2px 0';
                list.appendChild(li);
            }
            window.addEventListener('error', function (event) {
                const m = event.message + ' at ' + event.filename + ':' + event.lineno + ':' + event.colno;
                if (m.startsWith('Warning: ')) return;
                addError(m);
            });
            window.addEventListener('unhandledrejection', function (event) {
                const reason = event.reason;
                const m = 'Unhandled Rejection: ' + (reason && reason.stack ? reason.stack : reason);
                addError(m);
            });
            const origConsoleError = console.error;
            console.error = function (...args) {
                origConsoleError.apply(console, args);
                args.forEach(arg => {
                    const m = typeof arg === 'string' ? arg : (arg && arg.stack ? arg.stack : JSON.stringify(arg));
                    if (m.startsWith('Warning: ')) return;
                    addError(m);
                });
            };
        })();
    </script>

</body>

</html>